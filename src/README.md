# Agrigento

Agrigento is a framework to perform black-box differential analysis on the network traffic generated by Android apps to identify privacy leaks.

## Install

To install Agrigento and its dependencies on Ubuntu just run:

```
./install.sh
```

Agrigento requires other modules to be installed on the Android device:

* [[Xposed](http://repo.xposed.info/)].
* [[CryptoHooker](https://github.com/ucsb-seclab/agrigento/tree/master/crypto-hooker)] - Collect contentextual information.
* [[Changer](https://github.com/ucsb-seclab/agrigento/tree/master/changer)] - Modify the values of private information sources.
* [[JustTrustMe](https://github.com/Fuzion24/JustTrustMe)] - Handle certificate pinning.
* [[Android Mock-location](https://github.com/amotzte/android-mock-location-for-development)] - Allow to set mock location throught ADB.

Also, Agrigento requires the permissions/capabilities to set iptables.

## Config


#### general_config.py

`RUNS_PER_APP`: Number of times each app is executed.  
`FLOWS_FOLDER`: Folder where to store the collected flows.  
`CRYPTOHOOKER_LOGS_FOLDER`: Folder where to store the CryptoHooker logs.  
`WHITE_TREES_FOLDER`: Folder where to store the results of the differential analysis.

#### values.py

Set the values of private information sources.

#### proxy_config.py

Set `PROXY_IP`, `PROXY_PORT`, and `IFACE`.

## Run

Runs an APK multiple times on the given device, collects flows and CryptoHooker logs in the destination folders.
Then changes all the values of private information sources, runs the APK again and performs the differential analysis.
If any difference is detected, runs again the APK by changing one information source at the time.
```
python analyze-app.py <device_name> <apk_path>
```

Performs the differential analysis of all the collected data for a given app.
```
python analyze-leaks.py <app_name> [<num_runs> <flows_folder> <cryptohooker_logs_folder> <white_trees_folder>]
```

Runs the app multiples times *without* altering the values of private information sources.
```
python analyze-app-fps.py <device_name> <apk_path>
```

Performs the differential analysis *without* leveraging contextual information.
```
python analyze-randomness.py <app_name> [<num_runs>]
```

Performs the differential analysis step by step until convergence.
```
python simulate-convergence.py <app_name> <flows_folder> <cryptohooker_logs_folder> <white_trees_folder> [<convergence_threshold>]
```
